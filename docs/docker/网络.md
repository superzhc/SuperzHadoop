# 网络

安装 Docker 以后，会默认创建三种网络，可以通过 `docker network ls` 查看。

```bash
[root@localhost ~]# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
688d1970f72e        bridge              bridge              local
885da101da7d        host                host                local
f4f1b3cf1b7f        none                null                local
```

## 网络模式

### Bridge 模式

> 为每一个容器分配、设置 IP 等，并将容器连接到一个 docker0 虚拟网桥，默认为该模式。

### Host 模式

> 容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。

### Container 模式 

> 新创建的容器不会创建自己的网卡和配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。

### None 模式

> 容器有独立的 Network namespace，但并没有对其进行任何网络设置，如分配 veth pair 和网桥连接，IP 等。

## 操作命令

### 查看网络

```shell
docker network ls [OPTIONS]
```

**示例**

```shell
docker network ls

docker network ls --no-trunc

# 参数 -f:过滤条件
docker network ls -f 'driver=host'
```

### 创建网络

```shell
docker network create [OPTIONS] NETWORK
```

**常用参数**

- `-d`/`--driver`:string 指定网络的驱动(默认 "bridge")
- `--subnet`:strings 指定子网网段(如192.168.0.0/16、172.88.0.0/24)
- `--ip-range`:strings  执行容器的IP范围，格式同subnet参数
- `--gateway`:strings 子网的IPv4 or IPv6网关，如(192.168.0.1)

**示例**

```shell
# 新建bridge网络
# -d 参数指的是DRIVER的类型
docker network create -d bridge demo-net # 新建虚拟网络
```

### 删除网络

```shell
docker network rm NETWORK [NETWORK...]
```

### 查看网络详细信息

```shell
docker network inspect [OPTIONS] NETWORK [NETWORK...]

docker inspect [OPTIONS] NETWORK [NETWORK...]
```

### 使用网络

> 为启动的容器指定网络模式

```shell
docker run/create --network NETWORK
```

### 网络连接与断开

```shell
docker network connect [OPTIONS] NETWORK CONTAINER 

docker network disconnect [OPTIONS] NETWORK CONTAINER
```

### 全示例

```shell
docker network create -d bridge --subnet=172.172.0.0/24 --gateway 172.172.0.1 network
# 172.172.0.0/24: 24代表子码掩码是255.255.255.0 172.172.0.0/16: 16 代表子码掩码

docker network ls

docker run -itd --name nginx3 -p 80:80 --net network --ip 172.172.0.10 nginx:1.19.3-alpine

# --net mynetwork:选择存在的网络
# --ip 172.172.0.10:给nginx分配固定的IP地址

docker network inspect network
```

## FAQ

### 容器连接宿主机网络

1. 宿主机配置 Host:`127.0.0.1 host.docker.internal`
2. 容器访问域名 `host.docker.internal` 即可访问宿主机网络