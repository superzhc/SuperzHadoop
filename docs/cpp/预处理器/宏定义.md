# 宏定义

> 宏定义属于控制⾏预处理指⽰符。以 `#define` 定义的⼀个符号称为宏（macro）。

```c
#define 标识符 [替换文本]
```

**带参数的宏定义**

```c
#define 标识符(参数列表) [替换文本]
```

注意：替换文本是可缺省的

**示例**

```c
#include <stdio.h>

// 这⾥定义了⼀个缺省替换列表的宏 MY_MACRO
#define MY_MACRO
// 这⾥定义了⼀个宏对象 MY_MACRO1，其替换文本为：100
#define MY_MACRO1 100
// 这⾥定义了⼀个宏对象 MY_MACRO2，其替换文本为：10 + a
#define MY_MACRO2 10 + a

// 这个宏对象直接定义了⼀个函数
// 如果替换列表中的代码较⻓，那么可以⽤ \ 后⾯紧跟换⾏符来进⾏换行，
// 这⾥要注意的是，\ 后⾯不应该再跟其他空⽩符，⽽是要直接紧跟换⾏符
#define MY_MACRO3 static int Foo(void) { \
return 1; \
}

// 这⾥使⽤了宏 MY_MACRO3，因此在预处理期间，这⾥会将 MY_MACRO3 扩展为上述替换列表中的函数定义。
// 所以这⾥使⽤ MY_MACRO3，就相当于安插了这段代码：
// static int Foo(void){return1;}
MY_MACRO3

// 这⾥定义了⼀个宏函数 MY_SWAP，⽤于交换两个实参的值。
// 这⾥要注意，MY_SWAP 与(之间不应该出现空⽩符。
// 这⾥假定 x 和 y 都是整数类型
#define MY_SWAP(x, y) { int tmp = x; x = y; y = tmp; }

static void Dummy(void)
{
    // 这⾥ MY_MACRO4 是⼀个宏对象，⽽不是函数，
    // 因为 MY_MACRO4 与(之间有⼀个空格（空⽩符）。
    // 这⾥尽管定义在了 Dummy 函数的语句块作⽤域内，
    // 但仍然可以在当前⽂件作⽤域中任何位置使⽤
    #define MY_MACRO4 (a, b)
}

int main(int argc, const char * argv[])
{
    // 在预处理期间，MY_MACRO 的替换不包含任何预处理符号；
    // MY_MACRO1 会被⾃动替换为100
    int a = MY_MACRO MY_MACRO1;

    // 在预编译处理期间，MY_MACRO2 会被⾃动替换为10 + a，
    // 因此整个表达式在编译前会变为：int b = 10 + a * 3
    int b = MY_MACRO2 * 3;

    // 这⾥ a 的值为 100，b 的值为 10 + a * 3 等于 310
    printf("a = %d, b = %d\n", a, b);

    // 这⾥直接调⽤了Foo函数，由于在 main 函数上已经使⽤了宏 MY_MACRO3，
    // 所以它在预处理阶段扩展后，被替换成了对Foo函数的定义
    a = Foo();
    printf("a = %d\n", a);

    // 这⾥使⽤了宏函数 MY_SWAP，并且将对象标识符 a 和 b 作为其实参传⼊，
    // 此时预处理器在扩展时就会将 MY_SWAP(a, b) 替换为以下代码：
    // { int tmp = a; a = b; b = tmp; }
    // 各位可以注意到，) 符号后⾯没有添加分号，因为 } 作为复合语句结尾时分号可省
    MY_SWAP(a, b)

    // 交换之后a的值为 310，b 的值为 1
    printf("a = %d, b = %d\n", a, b);

    // 这⾥使⽤了 MY_MACRO4 宏对象，在预处理阶段进⾏扩展时会变为：a = (a, b);
    // 因此，这条表达式语句会将对象b的值赋给对象a。
    // 此外，尽管 MY_MACRO4 定义在了 Dummy 函数内，但仍然可以在 main 函数中使⽤
    a = MY_MACRO4;

    // 这⾥会输出OK
    if(a == b)
        puts("OK!");
}

// 错误的宏定义，在 # 符号之前不允许出现除空⽩符之外的任何其他字符
MY_MACRO #define ERROR_MACRO

// 以下宏定义没问题，由于在 # 之前只有空⽩符。
// # 与 define 之间允许存在除了换⾏符以外的其他空⽩符
# define OK_MACRO
```