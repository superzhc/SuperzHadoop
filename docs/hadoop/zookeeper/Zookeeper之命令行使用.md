## 服务端

### 运行服务

进入 bin 目录，使用 **`zkServer.sh start`** 启动服务

![img](../images/616953-20161102113533674-12957912.png)

使用 `jps` 命令查看，存在 `QuorumPeerMain` 进程，表示 Zookeeper 已经启动

### 停止服务

在bin目录下，使用**`zkServer.sh stop`**停止服务

![img](../images/616953-20161102113822252-835006402.png)

使用 `jps` 命令查看，`QuorumPeerMain` 进程已不存在，表示 Zookeeper 已经关闭

## 客户端

在服务端开启的情况下，运行客户端，使用如下命令：**`./zkCli.sh`**

<img src="../images/616953-20161102154207080-1243173093.png" alt="img" style="zoom:67%;" />
<img src="../images/616953-20161102153944565-787818501.png" alt="img" style="zoom:67%;" />

连接服务端成功，若连接不同的主机，可使用如下命令：**`./zkCli.sh -server ip:port`**

可以使用帮助命令**help**来查看客户端的操作

<img src="../images/616953-20161102155605268-358299230.png" alt="img" style="zoom:80%;" />

Zookeeper 客户端常用命令使用如下：

| 命令基本语法                  | 功能描述                                                     |
| ----------------------------- | ------------------------------------------------------------ |
| help                          | 显示所有操作命令                                             |
| [ls path [watch]](#读取节点)  | 使用 ls 命令来查看当前znode中所包含的内容                    |
| [ls2 path [watch]](#读取节点) | 查看当前节点数据并能看到更新次数等数据                       |
| [create](#创建节点)           | 普通创建 <br> 参数`-s`: 含有序列 <br>参数`-e`:临时节点（重启或超时消失） |
| [get path [watch]](#读取节点) | 获得节点的值                                                 |
| [set](#更新节点)              | 设置节点的具体值                                             |
| stat                          | 查看节点状态                                                 |
| [delete](#删除节点)           | 删除节点                                                     |
| rmr                           | 递归删除节点                                                 |

### 创建节点

使用 `create` 命令，可以创建一个 Zookeeper 节点，如：

```sh
create [-s] [-e] path data acl
```

其中，`-s` 或 `-e` 分别指定节点特性，顺序或临时节点，若不指定，则表示持久节点；`acl` 用来进行权限控制。

**① 创建顺序节点**

使用 **`create -s /zk-test 123`** 命令创建 zk-test 顺序节点

![img](../images/616953-20161102155803799-1536524204.png)

可以看到创建的 zk-test 节点后面添加了一串数字以示区别。

**② 创建临时节点**

使用 **`create -e /zk-temp 123`** 命令创建 zk-temp 临时节点

![img](../images/616953-20161102160232549-1082367462.png)

临时节点在客户端会话结束后，就会自动删除，下面使用**`quit`**命令退出客户端

![img](../images/616953-20161102160426440-778846503.png)

再次使用客户端连接服务端，并使用`ls /` 命令查看根目录下的节点

![img](../images/616953-20161102160634783-336378757.png)

可以看到根目录下已经不存在zk-temp临时节点了。

**③ 创建永久节点**

使用 **`create /zk-permanent 123`** 命令创建 zk-permanent 永久节点

![img](../images/616953-20161102161119393-1467499512.png)

可以看到永久节点不同于顺序节点，不会自动在后面添加一串数字。

### 读取节点

与读取相关的命令有 `ls` 命令和 `get` 命令，`ls` 命令可以列出 Zookeeper 指定节点下的所有子节点，只能查看指定节点下的第一级的所有子节点；`get` 命令可以获取 Zookeeper 指定节点的数据内容和属性信息。其用法分别如下

```sh
ls path [watch]

get path [watch]

ls2 path [watch]
```

若获取根节点下面的所有子节点，使用**`ls /`** 命令即可

![img](../images/616953-20161102161710690-1591213773.png)

若想获取根节点数据内容和属性信息，使用**`get /`** 命令即可

![img](../images/616953-20161102162003940-1583548451.png)

也可以使用**`ls2 /`** 命令查看

![img](../images/616953-20161102170200111-342568243.png)

可以看到其子节点数量为 8。

若想获取 `/zk-permanent` 的数据内容和属性，可使用如下命令：**`get /zk-permanent`** 

![img](../images/616953-20161102163010658-944355759.png)

可以看到其数据内容为123，还有其他的属性。

### 更新节点

使用 `set` 命令，可以更新指定节点的数据内容，用法如下

```sh
set path data [version]
```

其中，data就是要更新的新内容，version表示数据版本，如将 `/zk-permanent` 节点的数据更新为456，可以使用如下命令：**`set /zk-permanent 456`**

![img](../images/616953-20161102164406080-1199775708.png)

现在dataVersion已经变为1了，表示进行了更新。

### 删除节点

使用 `delete` 命令可以删除 Zookeeper 上的指定节点，用法如下

```sh
delete path [version]
```

其中version也是表示数据版本，使用**`delete /zk-permanent`** 命令即可删除 `/zk-permanent` 节点

![img](../images/616953-20161102164951768-162720225.png)

可以看到，已经成功删除 `/zk-permanent` 节点。值得注意的是，**若删除节点存在子节点，那么无法删除该节点，必须先删除子节点，再删除父节点。**