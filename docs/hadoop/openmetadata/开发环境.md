# 开发环境配置

**下载源码且进入源码目录**

```shell
git clone https://github.com/open-metadata/OpenMetadata
cd openmetadata
```

## Ingestion Framework

### 创建 Python 虚拟环境

```shell
python3 -m venv env

# Windows
env/Script/activate.bat
# Linux
source env/bin/activate
```

### 安装包

```shell
# Windows
python -m pip install "ingestion[dev]/"

# Linux
make install_dev
```

### 执行生成代码

> 前提：`antlr4` 已安装部署到环境中
>
> antlr4 下载地址：<https://www.antlr.org/download/antlr-4.9.2-complete.jar>

**Windows**

```shell
# 需提前创建空文件夹 ingestion/src/metadata/generated
python scripts/datamodel_generation.py

java -jar /d/soft/antlr4/antlr-4.9.2-complete.jar -Dlanguage=Python3 -o ingestion/src/metadata/generated/antlr ./openmetadata-spec/src/main/antlr4/org/openmetadata/schema/*.g4

python -m pip install ingestion/
```

**Linux**

```shell
make generate
```

## OpenMetadata UI

> 使用 nvm 创建 nodejs 环境，当前开发环境配置使用 `nodejs==18.0.0`
>
> nvm 地址：<https://github.com/coreybutler/nvm-windows>

### 安装前端开发环境

```shell
nvm install 18.0.0
npm i yarn -g
```

**注意**：需要使用 `yarn>=3.0.0` 以上版本，不然编译不通过

### 执行生成代码

**从 Json Schema 生成 TypeScript 类型代码**

```shell
# 进入如下目录下：
cd openmetadata-ui/src/main/resources/ui/

yarn run json2ts
antlr4 -Dlanguage=JavaScript -o openmetadata-ui/src/main/resources/ui/src/generated/antlr ${PWD}/openmetadata-spec/src/main/antlr4/org/openmetadata/schema/*.g4
node parseConnectionSchema && rm -rf connTemp
```

> Windows系统下，生成代码会缺失，造成编译失败，待修复

**暂时解决方案**

在 Linux 环境下执行生成代码，将生成的代码拷贝到 Windows 环境下，生成代码所在路径 `generated` 和 `jsons`

## OpenMetadata Server

```shell
mvn clean install -DskipTests
```

**注意**

1. openmetadata server 使用了生成代码插件，需要先对工程执行编译，但 idea 默认是对 target 目录的代码是进行排除的，需要将 `target/generated-source` 设置为 `Generated Source Root` 目录，如下图所示：

![](images/开发环境20230912135909.png)

**备注**

Windows 环境下，执行到 `openmetadata-ui` 直接执行会报错，需要将 `package.json` 中的 `"postinstall": "yarn run build-check",` 删除，并在 `pom.xml` 中对 yarn 更新到 yarn3，在 `frontend-maven-plugin` 插件中添加如下执行步骤：

```xml
<execution>
    <id>yarn upgrade</id>
    <goals>
        <goal>yarn</goal>
    </goals>
    <phase>prepare-package</phase>
    <configuration>
        <arguments>set version stable</arguments>
    </configuration>
</execution>
```