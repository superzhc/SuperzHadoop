一个独立的 Kafka 服务器被称为 broker。broker 接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。broker 为消费者提供服务，对读取分区的请求作出响应，返回已经提交到磁盘上的消息。

broker 是集群的组成部分每个集群都有一个 broker 同时充当了集群控制器的角色（自动从集群的活跃成员中选举出来）。控制器负责管理工作，包括将分区分配给 broker 和监控 broker。在集群中，一个分区从属于一个 broker，该 broker 被称为分区的首领。一个分区可以分配给多个 broker，这个时候会发生分区复制。这种复制机制为分区提供了消息冗余，如果有一个 broker 失效，其他 broker 可以接管领导权。

Message 在 Broker 中通过 Log 追加的方式进行持久化，并进行分区（partitions）

为了减少磁盘写入的次数，broker 会将消息暂时 buffer 起来，当消息的个数（或者大小）达到一定阈值时，在 flush 到磁盘，这样减少了磁盘 IO 调用的次数

Broker 不保存订阅者的状态，由订阅者自己保存

无状态导致消息的删除成为难题（可能删除的消息正在被订阅），Kafka 采用基于时间的 SLA（服务水平保证），消息保存一定时间（通常为 7 天）后会被删除

消息订阅者可以 rewind back 到任意位置重新进行消费，当订阅者故障时，可以选择最小的  offset（id）进行重新读取消费消息

