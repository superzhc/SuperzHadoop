**HDFS 通过备份数据块的形式来实现容错**，除了文件的最后一个数据块外，其它所有数据块大小都是一样的。数据块的大小和备份因子都是可以配置的。NameNode 负责各个数据块的备份，DataNode 会通过心跳的方式定期的向 NameNode 发送自己节点上的Block 报告，这个报告中包含了 DataNode 节点上的所有数据块的列表。

文件副本的分布位置直接影响着 HDFS 的可靠性和性能。一个大型的 HDFS 文件系统一般都是需要跨很多机架的，不同机架之间的数据传输需要经过网关，并且，同一个机架中机器之间的带宽要大于不同机架机器之间的带宽。如果把所有的副本都放在不同的机架中，这样既可以防止机架失败导致数据块不可用，又可以在读数据时利用到多个机架的带宽，并且也可以很容易的实现负载均衡。但是，如果是写数据，各个数据块需要同步到不同的机架，会影响到写数据的效率。

而在 Hadoop 中，如果副本数量是 3 的情况下，Hadoop 默认是这么存放的，把第一个副本放到机架的一个节点上，另一个副本放到同一个机架的另一个节点上，把最后一个节点放到不同的机架上。这种策略减少了跨机架副本的个数提高了写的性能，也能够允许一个机架失败的情况，算是一个很好的权衡。

**关于副本的选择**，在读的过程中，HDFS 会选择最近的一个副本给请求者。

**关于安全模式**，当 Hadoop 的 NameNode 节点启动时，会进入安全模式阶段。在此阶段，DataNode 会向 NameNode 上传它们数据块的列表，让 NameNode 得到块的位置信息，并对每个文件对应的数据块副本进行统计。当最小副本条件满足时，即一定比例的数据块都达到最小副本数，系统就会退出安全模式，而这需要一定的延迟时间。当最小副本条件未达到要求时，就会对副本数不足的数据块安排 DataNode 进行复制，直至达到最小副本数。而在安全模式下，系统会处于只读状态，NameNode 不会处理任何块的复制和删除命令。

