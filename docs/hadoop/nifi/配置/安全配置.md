# 安全配置

| 属性                             | 描述                                                                                                      |
| -------------------------------- | --------------------------------------------------------------------------------------------------------- |
| `nifi.security.keystore`         | 包含服务器私钥的密钥库的文件名                                                                            |
| `nifi.security.keystoreType`     | 密钥库的类型，必须为 PKCS12 或 JKS。JKS 是首选类型，BCFKS 和 PKCS12 文件将通过 BouncyCastle 提供程序加载  |
| `nifi.security.keystorePasswd`   | 密钥库的密码                                                                                              |
| `nifi.security.keyPasswd`        | 密钥库中证书的密码。如果未设置，将使用 `nifi.security.keystorePasswd` 的值                                |
| `nifi.security.truststore`       | 信任库的文件名，将用于授权那些连接到 NiFi 的用户。没有 Truststore 的安全实例将拒绝所有传入连接            |
| `nifi.security.truststoreType`   | 信任库的类型。必须为 PKCS12 或 JKS。 JKS 是首选类型，BCFKS 和 PKCS12 文件将通过 BouncyCastle 提供程序加载 |
| `nifi.security.truststorePasswd` | 信任库的密码                                                                                              |

<!--
|``||
|``||
|``||
|``||
|``||
-->

## 用户认证

NiFi 支持通过 **客户端证书**，**用户名/密码**，**Apache Knox** 或 **OpenId Connect** 进行用户身份验证。

### 用户名/密码

用户名/密码的验证是由 Login Identity Provider 执行的，Login Identity Provider 是一种可插拔的机制。在 `nifi.properties` 文件中配置要使用的 Login Identity Provider。目前的 NiFi 在 Login Identity Provider 提供了带有用户名/密码登陆的认证选项：**Single User**，**轻量级目录访问协议(LDAP)** 和 **Kerberos**。

- `nifi.login.identity.provider.configuration.file` 属性指定 Login Identity Provider 的配置文件。默认情况下，此属性设置为 `./conf/login-identity-providers.xml`。
- `nifi.security.user.login.identity.provider` 属性指示应使用哪个已配置的 Login Identity Provider。默认情况下，配置为 `single-user-provider`，使用的是自动生成的用户名密码。

#### 单用户

默认的 `Single User Login Identity Provider` 支持自动生成用户名和密码。

生成的用户名将是由 36 个字符组成的随机 UUID。生成的密码将是一个由 32 个字符组成的随机字符串，并 bcrypt 哈希。

`nifi.properties` 中的默认配置是启用了单用户身份验证:

```properties
nifi.security.user.login.identity.provider=single-user-provider
```

默认的 `login-identity-providers.xml` 包含一个空白的 provider:

```xml
<provider>
   <identifier>single-user-provider</identifier>
   <class>org.apache.nifi.authentication.single.user.SingleUserLoginIdentityProvider</class>
   <property name="Username"/>
   <property name="Password"/>
</provider>
```

使用下面的命令可以修改用户名密码

```sh
./bin/nifi.sh set-single-user-credentials <username> <password>
```

#### 轻量级目录访问协议(LDAP)

#### kerberos

### OpenId Connect

### SAML

### Apache Knox

