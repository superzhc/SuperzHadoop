# 安装部署

## 环境配置

**关闭交换分区**

```sh
# 查看 Swap 状态
free -m

# 使用如下命令临时关闭交换分区
swapoff -a
# 永久关闭需要到 /etc/fstab 中注释掉 swap 分区
```

**设置系统最大打开文件句柄数**

```
vi /etc/security/limits.conf

* soft nofile 65536
* hard nofile 65536
```

<!--

**时钟同步**

见[时钟同步](../../linux/NTP服务.md)

-->

**JDK8 安装**

见：[JDK安装](../../java/安装部署.md)

**查看 GCC 的版本**

```sh
# doris v1.2 要求 GCC 的版本为 4.8.2 及以上
gcc --version
```

## 下载

官方下载界面：<https://doris.apache.org/zh-CN/download/>

**解压**

```sh
# 示例
tar -xvf apache-doris-1.2.4.1-bin-x86_64.tar.xz
```

## FE 部署

**配置文件（`fe.conf`）**

```sh
# 该参数必须配置，见：https://doris.apache.org/zh-CN/docs/1.2/get-starting/
priority_networks=172.23.16.0/24

# 设置 meta_dir
# JAVA_OPTS 中最大堆内存调整到 8G
```

**启动 FE**

```sh
./bin/start_fe.sh --daemon
```

**访问界面**

<http://fe_ip:8030>

## BE 部署

**操作系统设置**

```sh
sysctl -w vm.max_map_count=2000000

# 临时设置文件句柄数
ulimit -n 65536

# 设置系统最大打开文件句柄数
vi /etc/security/limits.conf

* soft nofile 65536
* hard nofile 65536
```

**配置文件**

```sh
# 该参数必须配置，见：https://doris.apache.org/zh-CN/docs/1.2/get-starting/
priority_networks=172.23.16.0/24
```

**启动 BE**

```sh
# --daemon 后台启动模式，首次建议不添加该参数，当能与 FE 通信后，再已后台运行的模式进行启动
./bin/start_be.sh --daemon
```

**添加 BE 节点到集群**

> 通过 MySQL 客户端连接到 FE 之后，执行如下 SQL 将 BE 添加到集群中

```sh
ALTER SYSTEM ADD BACKEND "be_host_ip:heartbeat_service_port";
```