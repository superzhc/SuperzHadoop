# RDD 依赖关系

在 RDD 中将依赖划分成了两种类型：**窄依赖**（Narrow Dependency）和**宽依赖**（Wide Dependency），如下图所示：

<img src="images/%E5%9B%BE9-10-%E7%AA%84%E4%BE%9D%E8%B5%96%E4%B8%8E%E5%AE%BD%E4%BE%9D%E8%B5%96%E7%9A%84%E5%8C%BA%E5%88%AB.jpg" alt="图9-10 窄依赖与宽依赖的区别" style="zoom: 70%;" />

*窄依赖表现为一个父 RDD 的分区对应于一个子 RDD 的分区，或多个父 RDD 的分区对应于一个子 RDD 的分区*。如上图(a)中，RDD1 是RDD2 的父 RDD，RDD2 是子 RDD，RDD1 的分区 1，对应于 RDD2 的一个分区（即分区 4）；再比如 RDD6 和 RDD7 都是 RDD8 的父RDD，RDD6 中的分区（分区15）和 RDD7 中的分区（分区18），两者都对应于 RDD8 中的一个分区（分区 21）。

*宽依赖则表现为存在一个父 RDD 的一个分区对应一个子 RDD 的多个分区。*如上图(b)中，RDD9 是 RDD12 的父 RDD，RDD9 中的分区 24 对应了 RDD12 中的两个分区（即分区 27 和分区 28）。

总体而言，*如果父 RDD 的一个分区只被一个子 RDD 的一个分区所使用就是窄依赖，否则就是宽依赖*。窄依赖典型的操作包括 map、filter、union 等，宽依赖典型的操作包括 groupByKey、sortByKey 等。对于连接（join）操作，可以分为两种情况：

1. 对输入进行协同划分，属于窄依赖。所谓协同划分（co-partitioned）是指多个父 RDD 的某一分区的所有“键（key）”，落在子 RDD的同一个分区内，不会产生同一个父 RDD 的某一分区，落在子 RDD 的两个分区的情况。
2. 对输入做非协同划分，属于宽依赖。

对于窄依赖的 RDD，可以以流水线的方式计算所有父分区，不会造成网络之间的数据混合。对于宽依赖的 RDD，则通常伴随着 Shuffle 操作，即首先需要计算好所有父分区数据，然后在节点之间进行 Shuffle。