# 分支管理

## 创建和合并分支

在 Git 里，`master` 分支叫**主分支**。`HEAD` 严格来说不是指向提交，而是指向 `master`，`master` 才是指向提交的，所以 `HEAD` 指向的就是当前分支。

- **Git创建和合并分支过程**

1. 最开始 `master` 分支是一条线，Git 用 `master` 指向最新的提交，再用 `HEAD` 指向 `master`，就能确定当前分支，以及当前分支的提交点：
   
    ![Git分支使用](./images/Git_分支1.png)
    
    每次提交，`master` 分支都会向前移动一步，这样，随着不断提交，`master` 分支的线也越来越长。

2. 当创建新的分支，例如 `dev` 时，Git 新建了一个指针叫 `dev`，指向 `master` 相同的提交，再把 `HEAD` 指向 `dev`，就表示当前分支在 `dev` 上：
    
    ![Git分支使用](./images/Git_分支2.png)

3. 从现在开始，对工作区的修改和提交就是针对 `dev` 分支了，比如新提交一次后，`dev` 指针往前移动一步，而 `master` 指针不变：
    
    ![Git分支使用](./images/Git_分支3.png)

4. 假如在 `dev` 上的工作完成了，就可以把 `dev` 合并到 `master` 上。实现方式就是直接把 `master` 指向 `dev` 的当前提交，就完成了合并：
    
    ![Git分支使用](./images/Git_分支4.png)

5. 合并完分支后，甚至可以删除 `dev` 分支。删除 `dev` 分支就是把 `dev` 指针给删掉，删掉后就剩下了一条 `master` 分支：
    
    ![Git分支使用](./images/Git_分支5.png)

- **创建和合并分支实战**

- 创建 `dev` 分支，然后切换到 `dev` 分支:`git checkout -b dev`
- 合并到主分支上，首先切换到主分支:`git checkout master`，再进行合并:`git merge dev`
- 删除 `dev` 分支:`git branch -d dev`

## 解决冲突

当 Git 无法执行“快速合并”，只能试图把各自的修改合并起来，但这种合并就可能会有冲突；对于冲突的文件必须手动进行修改，直接查看冲突文件会发现 Git 用 `<<<<<<<`，`=======`，`>>>>>>>` 标记出不同分支的内容，对文件进行修改后再次提交，即可合并成功。

- **总结**

当 Git 无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。

解决冲突就是把 Git 合并失败的文件手动编辑为我们希望的内容，再提交。

## 分支管理策略

- `master` 分支是稳定版本，不用于开发，仅用来发布新版本
- `dev` 分支，用于开发，不是稳定版本；到某个时候，比如 1.0 版本发布时，再把 dev 分支合并到 master 上，在 master 分支发布 1.0 版本；

团队合作的分支一般如下：

![Git分支策略](./images/Git_分支策略.png)

## 多人协作

当从远程仓库克隆时，实际上 Git 自动把本地的 `master` 分支和远程的 `master` 分支对应起来了，并且远程仓库的默认名称是 `origin`。

- **推送分支**

推送分支，就是把该分支上的所有本地提交推送到远程库。推送时要指定本地分支，这样 svn 就会把该分支推送到远程库对应的远程分支上

```bash
git push origin master
```

如果要推送其他分支，如 `dev`，就改成：

```bash
git push origin dev
```

推送分支的规则：
- `master` 分支是主分支，因此要时刻与远程同步；
- `dev` 分支是开发分支，团队所有的成员都需要在上面工作，所以也需要与远程同步；
- `bug` 分支之用于在本地修复bug，不需要推送到远程
- `feature` 分支是否需要推送到远程，取决于是否需要协作开发

- **多人协作的工作模式**

1. 首先试图用 `git push origin <branch-name>` 推送修改；
2. 如果推送失败，则因为远程分支的版本比本地更新，需要先用 `git pull` 试图合并；
3. 如果合并有冲突，则解决冲突，并本地提交；
4. 没有冲突或者解决掉冲突后，再用 `git push origin <branch-name>` 推送就能成功

注：如果 `git pull` 提示 `no tracking information`，则说明本地分支和远程分支的链接关系没有创建，用命令 `git branch --set-upstream-to <branch-name> origin/<branch-name>`。