# Git

Git 是目前世界上最先进的分布式版本控制系统。

- **集中式和分布式版本控制系统的区别**

集中式版本控制系统，版本库是存储在中央服务器的，使用的时候要从中央服务器取得最新的版本，进行了操作要将这些操作推送给中央服务器。

![集中式版本控制系统](./images/Git_集中式.jpg)

集中式版本控制系统最大的问题就是必须联网才能工作，如果在局域网内还好，带宽够大，速度够快，可如果在互联网上，遇到网速慢的话，可能提交一个 10M 的文件就需要 5 分钟。

分布式版本控制系统，它根本没有"中央服务器"，每个人的电脑上都是一个**完整的版本库**，*它自身就可以进行版本上的维护*，这样，工作的时候就不需要联网了，因为版本库就在自己的电脑上。因为版本库在每个人的电脑上，每个版本库都可以拉取和推送数据给其他版本库来完成协作工作。比方说你在自己的电脑上修改了文件 A，你的同事也在他的电脑上修改了文件 A，这时，你们俩之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。

![分布式版本控制系统](./images/Git_分布式.jpg)

和集中式版本控制系统相比，分布式版本控制系统的安全性要高很多，因为每个人电脑里都有完整的版本库，某一个人的电脑坏掉了不要紧，随便从其他人那里复制一个就可以了。而集中式版本控制系统的中央服务器要是出了问题，所有人都没法使用了。

在实际使用分布式版本控制系统的时候，其实很少在两人之间的电脑上推送版本库的修改，因为可能你们俩不在一个局域网内，两台电脑互相访问不了，也可能今天你的同事病了，他的电脑压根没有开机。因此，分布式版本控制系统通常也有一台充当“中央服务器”的电脑，但这个服务器的作用仅仅是用来方便“交换”大家的修改，没有它大家也一样干活，只是交换修改不方便而已。

- **其他版本控制系统**

CVS 作为最早的开源而且免费的集中式版本控制系统，直到现在还有不少人在用。由于 CVS 自身设计的问题，会造成提交文件不完整，版本库莫名其妙损坏的情况。同样是开源而且免费的 SVN 修正了 CVS 的一些稳定性问题，是目前用得最多的集中式版本库控制系统。

除了免费的外，还有收费的集中式版本控制系统，比如 IBM 的 ClearCase（以前是 Rational 公司的，被 IBM 收购了），特点是安装比 Windows 还大，运行比蜗牛还慢，能用 ClearCase 的一般是世界 500 强，他们有个共同的特点是财大气粗。

微软自己也有一个集中式版本控制系统叫 VSS，集成在 Visual Studio 中。由于其反人类的设计，连微软自己都不好意思用了。

分布式版本控制系统除了 Git 以及促使 Git 诞生的 BitKeeper 外，还有类似 Git 的 Mercurial 和 Bazaar 等。这些分布式版本控制系统各有特点，但最快、最简单也最流行的依然是 Git。

## 工作区

工作区：Working Directory

电脑可见的目录都是工作区。

## 版本库

版本库，又被称为仓库（repository），可以简单的理解为一个目录，这个目录里面的所有文件都可以被 Git 管理起来，每个文件的修改、删除，Git 都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。

在工作区中有一个隐藏目录 `.git`，这个不算工作区，而是 Git 的版本库。

- **创建版本库**

1. 在一个目录下，创建一个空目录【注：Windows 系统下，为了避免遇到各种莫名其妙的问题，确保目录名（包括父目录）中不包含中文】
2. 通过 `git init` 命令把这个目录变成 Git 可以管理的仓库

注：创建好的版本仓库下会有一个 `.git` 目录，这个目录是 Git 用来跟踪管理版本库的。

- **把文件添加到版本库**

首先明确一下，所有的版本控制系统，其实只能跟踪文本文件的改动，比如 TXT 文件，网页，所有的程序代码等等，Git 也不例外。版本控制系统可以记录每次的改动，比如在第 5 行加了一个单词 “Linux”，在第 8 行删了一个单词 “Windows”。而图片、视频这些二进制文件，虽然也能由版本控制系统管理，但没法跟踪文件的变化，只能把二进制文件每次改动串起来，也就是只知道图片从 100KB 改成了 120KB，但到底改了啥，版本控制系统不知道，也没法知道。

注：Microsoft 的 Word 格式也是二进制格式，因此，版本控制系统是没法跟踪 Word 文件的改动的。

添加文件到 Git 仓库，分两步：

1. 使用命令 `git add <file>`，注意，可反复多次使用，添加多个文件；
2. 使用命令 `git commit -m <message>`，完成。

## 暂存区

Git 的版本库里存了很多东西，其中最重要的就是称为 `stage`（或者叫 `index`）的 **暂存区**，还有 Git 为用户自动创建的第一个分支 `master`，以及指向 `master` 的一个指针叫 `HEAD`。

![暂存区](./images/Git_stage.jpg)

## 远程仓库

Git 是分布式版本控制系统，同一个 Git 仓库，可以分布到不同的机器上。因为最早肯定只有一台机器有一个原始版本库，此后，别的机器可以“克隆”这个原始版本库，而且每台机器的版本库其实都是一样的，并没有主次之分。

### GitHub

GitHub 是提供 Git 仓库托管服务的，所以只要注册一个 GitHub 账号，就可以免费获得 Git 远程仓库。

因*本地 Git 仓库和 GitHub 仓库之间的传输是通过 SSH 加密*的，所以要进行如下设置：
1. **创建SSH Key**。在用户主目录下，看看有没有`.ssh`目录，如果有，再看看这个目录下有没有 `id_rsa` 和 `id_rsa.pub` 这两个文件，如果已经有了，可直接跳到下一步。如果没有，打开 Shell（Windows 下打开 Git Bash），创建 SSH Key：`$ ssh-keygen -t rsa -C "youremail@example.com"`，把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可，由于这个 Key 也不是用于军事目的，所以也无需设置密码。成功后可以在用户主目录里找到 `.ssh` 目录，里面有 `id_rsa` 和 `id_rsa.pub` 两个文件，这两个就是 SSH Key 的秘钥对，`id_rsa` 是私钥，不能泄露出去，`id_rsa.pub` 是公钥，可以放心地告诉任何人。
2. 登陆 GitHub=>"Account settings"=>"SSH Keys" 页面=>点击 "Add SSH Key"=>填上任意 Title，在 Key 文本框里粘贴 `id_rsa.pub` 文件的内容，点击 "Add Key"

- **为什么GitHub需要SSH Key**

因为 GitHub 需要识别出推送的提交是你自己推送的，而不是别人冒充的，而 Git 支持 SSH 协议，所以 GitHub 只要知道了你的公钥，就可以确认只有你自己才能推送。

注：GitHub 允许你添加多个 Key。
