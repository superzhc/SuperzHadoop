# 配置文件

- `postgresql.conf`：该文件包含一些通用设置，比如内存分配、新建 database 的默认存储位置、PostgreSQL 服务器的 IP 地址、日志的位置以及许多其他设置
- `pg_hba.conf`：该文件用于控制 PostgreSQL 服务器的访问权限，具体包括：允许哪些用户连接到哪个数据库，允许哪些 IP 地址连接到本服务器，以及指定连接时使用的身份验证模式
- `pg_ident.conf`：如果该文件存在，则系统会基于文件内容将当前登录的操作系统用户映射为一个 PostgreSQL 数据库内部用户的身份来登录。有些人会把操作系统的 root 用户映射为 PostgreSQL 的 postgres 超级用户账号。

**查看配置文件位置**

```sql
SELECT name, setting FROM pg_settings WHERE category = 'File Locations';
```

**配置文件生效**

有些配置项修改后需要重启 PostgreSQL 服务实例才能生效，重启时会关闭所有客户端连接。有的配置项只需重新加载一下配置文件即可生效，此后连接上来的新用户都会自动读取到新的配置。重新加载配置文件时，原来已连接的用户会话不会受到影响。如果你不确定修改了某个配置后是否需要重启，请查看下该配置项的 context 属性，如果是 `postmaster` ，那么需要重启；如果是 `user` ，那么重新加载配置文件即可。

## `postgresql.conf`

> `postgresql.conf` 有个伴生的配置文件 `postgresql.auto.conf`，其中的配置项会覆盖 `postgresql.conf` 的同名配置项。建议不要直接修改 `postgresql.conf`，而是优先修改 `postgresql.auto.conf`。

通过查询 `pg_settings` 视图即可查看所有配置项内容，无须打开配置文件。

**示例**

```sql
SELECT
    name,
    context,
    unit,
    setting, boot_val, reset_val
FROM pg_settings
WHERE name IN ( 'listen_addresses','deadlock_timeout','shared_buffers',
    'effective_cache_size','work_mem','maintenance_work_mem')
ORDER BY context, name;
```

context 字段代表配置项的作用范围，有如下值：

- user： 表示是用户级配置项，它可以被每个用户单独修改，也就是说该配置项针对每个用户都可以有不同的值，用户修改后会在自己的所有会话中生效。如果是超级用户修改了一个 user 级的配置项，那么所有此后连接上来的用户都会将这个修改过的值作为默认值。
- superuser：表示是超级用户级配置项，只能由超级用户来修改，修改并且重新加载后会在所有用户会话中生效。非超级用户不能在自己的会话中修改覆盖这个值。
- postmaster：表示是整个服务实例级配置项（postmaster 就代表了 PostgreSQL 服务实例），更改后需要重启 PostgreSQL 服务才能生效。

**修改 `postgresql.conf` 的值**

```sql
ALTER SYSTEM SET work_mem = '500MB';
```

该命令不会直接修改 `postgresql.conf` 文件本身，而是会去修改 `postgresql.auto.conf` 文件。