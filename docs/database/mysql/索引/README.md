> MySQL 官方对索引的定义为：索引（Index）是帮助 MySQL 高效获取数据的数据结构，而 MySQL使用的数据结构是： B+树

索引一般以文件形式存储在磁盘上，索引检索需要磁盘 I/O 操作。所以评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘 I/O 操作次数的渐进复杂度。

## 索引的存储结构分类

索引有很多种类型，可以为不同的场景提供更好的性能。在 MySQL 中，索引是在存储引擎层而不是服务器层实现的。所以，并没有统一的索引标准：不同存储引擎的索引的工作方式并不一样，也不是所有的存储引擎都支持所有类型的索引。即使多个存储引擎支持同一种类型的索引，其底层的实现也可能不同。

### 哈希索引

哈希索引基于哈希表实现，只有精确匹配索引所有列的查询才有效。

### B树索引

大多数 MySQL 引擎都支持的 **B树** 索引，**B树** 索引是使用 **B树** 数据结构来存储数据的。

**B树** 通常意味着所有的值都是按顺序存储的，并且每一个叶子页到根的距离相同。

**B树** 索引能够加快访问数据的速度，因为存储引擎不再需要进行全表扫描来获取需要的数据，取而代之的是从索引的根节点开始进行搜索。根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下层查找。通过比较节点页的值和要查找的值可以找到合适的指针进入下层子节点，这些指针实际上定义了子节点页中值的上限和下限。最终存储引擎要么找到对应的值，要么该记录不存在。

**B树** 对索引列是顺序组织存储的，所以很适合查找范围数据。

### 空间数据索引（R-Tree）

TODO

### 全文索引

全文索引是一种特殊类型的索引，它查找的是文本中的关键字，而不是直接比较索引中的值。

## 索引的分类

MySQL 索引的五种类型：主键索引、唯一索引、普通索引和全文索引、组合索引。通过给字段添加索引可以提高数据的读取速度，提高项目的并发能力和抗压能力

### 主键索引

主键是一种唯一性索引，但它必须指定为 PRIMARY KEY，每个表只能有一个主键

### 唯一索引

索引列的所有值都只能出现一次，即必须唯一，值可以为空

### 普通索引

基本的索引类型，值可以为空，没有唯一性的限制

### 全文索引

全文索引的索引类型为FULLTEXT，全文索引可以在 varchar、char、text类型的列上创建

### 组合索引

多列值组成的一个索引，专门用于组合搜索

## 索引的策略

### 独立的列

索引列不能是表达式的一部分，也不能是函数的参数，因为如果查询的列不是独立的，则 MySQL 就不会使用索引

### 前缀索引和索引选择性

前缀索引是可以**索引列的开始部分字符**，这样可以大大节约索引空间，从而提高索引效率。但这样会降低索引的选择性。索引的选择性是指，不重复的索引值（也称为基数）和索引表的记录总数（`#T`）的比值，范围从 `1/#T` 到 1 之间。索引的选择性越高则查询效率越高，因为选择性高的索引可以让 MySQL 在查询时过滤掉更多的行。唯一索引的选择性是 1，这是最好的索引选择性，性能也是最好的。

一般情况下某个列前缀的选择性也是足够高的，足以满足查询性能。对于 BLOB、TEXT 或者很长的 VARCHAR 类型的列，必须使用前缀索引，因为 MySQL 不允许索引这些列的完整长度。

前缀索引是一种能使索引更小、更快的有效办法，但另一方面也有其缺点：MySQL 无法使用前缀索引做 ORDER BY和 GROUP BY，也无法使用前缀索引做覆盖扫描。

### 多列索引

MySQL 5.0 引入了一种叫 `索引合并（index merge）` 的策略，一定程度上可以使用表上的多个单列索引来定位指定的行。该策略下查询能够同时使用多个单列索引进行扫描，并将结果合并。这种算法有三个变种：OR 条件的联合、AND 条件的相交，组合前两种情况的联合及相交。

### 选择合适的索引列顺序

*对于如何选择索引的列顺序有一个经验法则：将选择性最高的列放到索引最前列*。

然而，性能不只是依赖于所有索引列的选择性（整体基数），也和查询条件的具体值有关，也就是和值的分布有关。

### 聚簇索引

聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。InnoDB 中的聚簇索引实际上在同一个结构中保存了 **B树** 索引和数据行。

当表有聚簇索引时，它的数据行实际上存放在索引的叶子页（leaf page）中。

**一个表只能有一个聚簇索引**。

InnoDB 通过主键聚集数据，如果没有定义主键，InnoDB 会选择一个唯一的非空索引代替。如果没有这样的列，InnoDB 会隐式的定义一个主键来作为聚簇索引。

### 覆盖索引

如果一个索引包含（或者说覆盖）所有需要查询的字段的值就称之为 `覆盖索引`。

被查询的列，数据能从索引中取得，而不用通过行定位符 row-locator 再到 row 上获取，即“被查询列要被所建的索引覆盖”，这能够加速查询速度。

## 创建索引

### 索引类型

| 索引名                     | 类型                               |
| :------------------------- | :--------------------------------- |
| INDEX(field)               | 普通索引，只加速查找，无约束条件   |
| PRIMARY KEY(field)         | 主键索引，加速查找，非空且唯一约束 |
| UNIQUE(field)              | 唯一索引，加速查找，唯一约束       |
| INDEX(field1,field2)       | 联合普通索引                       |
| PRIMARY KEY(field1,field2) | 联合主键索引                       |
| UNIQUE(field1,field2)      | 联合唯一索引                       |
| FULLTEXT(field)            | 全文索引                           |
| SPATIAL(field)             | 空间索引                           |