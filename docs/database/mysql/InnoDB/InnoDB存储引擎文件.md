# InnoDB 存储引擎文件

对于每个表，存储引擎都有自己都有的文件，这些文件包括重做日志文件、表空间文件

## 表空间文件

**InnoDB 采用将存储的数据按表空间（tablespace）进行存放的设计**。在默认配置下会有一个初始大小为 10MB，名为 ibdata1 的文件。该文件就是默认的表空间文件（tablespace file），用户可以通过参数 `innodb_data_file_path` 对其进行设置，格式如下：

```
innodb_data_file_path=datafile_specl1[;datafile_specl2]...
```

用户可以通过多个文件组成一个表空间，同时制定文件属性。

若设置了参数 `innodb_file_per_table`，则用户可以将每个基于 InnoDB 存储引擎的表产生一个独立表空间。独立表空间的命名规则为 ：`表名.ibd`，通过这样的方式，用户不用将所有数据都存放于默认的表空间中。

需要注意的是，这些单独的表空间文件仅存储该表的数据、索引和插入缓冲 BITMAP 等信息，其余信息还是存放在默认表空间。

下图显示了 InnoDB 存储引擎对于文件的存储方式：

![image-20200331215915855](https://i.loli.net/2020/03/31/zRGYOS9iFLElkQ6.png)

## 重做日志文件

在默认情况下，在 InnoDB 存储引擎的数据目录下会有两个名为 ib_logfile0 和 ib_logfile1 的文件，这个文件称为 InnoDB 存储引擎的日志文件，不过更准确的定义应该是重做日志文件（redo log file），**该文件记录了对于 InnoDB 存储引擎的事务日志**。

当实例或介质失败（media failure）时，InnoDB 会使用重做日志文件恢复到失败前的状态，以此来保证数据的完整性。

每个 InnoDB 存储引擎至少有 1 个重做日志文件组（group），每个文件组下至少有 2 个重做日志文件，如默认的 ib_logfile0 和 ib_logfile1。为了得到更高的可靠性，用户可以设置多个的镜像日志组（mirrored log groups），将不同的文件组放在不同的磁盘上，以此提高重做日志的高可用性。在日志组中每个重做日志文件的大小一致，并以循环写入的方式运行。InnoDB 存储引擎先写重做日志文件 1，当达到文件的最后时，会切换至重做日志文件 2，再当重做日志文件 2 也被写满时，会再切换到重做日志文件 1 中。

参数 `innodb_log_group_home_dir` 指定了日志文件组所在的路径，默认为 `./`，表示在 MySQL 数据库的数据目录下。

重做日志文件的大小设置对于 InnoDB 存储引擎的性能有着非常大的影响。一方面重做日志文件不能设置得太大，如果设置的很大，在恢复时可能需要很长的时间；另一方面又不能设置得太小了，否则可能导致一个事务的日志需要多次切换重做日志文件；此外，重做日志文件太小会导致频繁地发生 async checkpoint，导致性能的抖动。