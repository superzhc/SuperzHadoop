# 特殊属性和特殊方法

## 特殊属性

### `__dict__`

默认情况下，Python 在各个实例中名为 `__dict__` 的字典里存储实例属性。

### `__slots__`

```py
class Demo:
    __slots__ = ["c1","c2"]
```

## 特殊方法

### 对象创建与销毁

| 方法                                 | 描述                     |
| ------------------------------------ | ------------------------ |
| `__new__(cls[,*args [,**kwargs]])`   | 创建新实例时调用的类方法 |
| `__init__(self[,*args [,**kwargs]])` | 初始化新实例时调用       |
| `__del__(self)`                      | 销毁实例时调用           |

### 对象字符串表示

| 方法                                | 描述                 |
| ----------------------------------- | -------------------- |
| `__ format__(self, format _ spec )` | 创建格式化后的表示   |
| `__ repr__(self)`                   | 创建对象的字符串表示 |
| `__ str__(self)`                    | 创建简单的字符串表示 |

### 属性访问

| 方法                             | 描述                                                                                                     |
| -------------------------------- | -------------------------------------------------------------------------------------------------------- |
| `__ getattribute__(self, name)`  | 返回属性 `self.name`                                                                                     |
| `__getattr__(self, name)`        | 如果通过 `__ getattribute__()` 未找到属性，返回属性 `self.name` ，无法计算属性则引发 AttributeError 异常 |
| `__setattr__(self, name, value)` | 设置属性 `self.name = value` ，覆盖默认值                                                                |
| `__delattr__(self, name)`        | 删除属性 `self.name`                                                                                     |

### 序列与映射方法

如果对象要模拟序列和映射对象的行为，需实现如下方法：

| 方法                                | 描述                                              |
| ----------------------------------- | ------------------------------------------------- |
| `__len__( self )`                   | 返回 self 的长度                                  |
| `__getitem__( self , key )`         | 返回 `self [ key ]`                               |
| `__setitem__( self , key , value )` | 设置 `self [ key ] = value`                       |
| `__delitem__( self , key )`         | 删除 `self [ key ]`                               |
| `__contains__( self , obj )`        | 如果 obj 在 self 中，则返回 True ，否则返回 False |

**示例**

```py
a = [1,2,3,4,5,6]
len(a)　　　　　　　　# a.__len__()
x = a[2]　　　　　　　# x = a.__getitem__(2)
a[1] = 7　　　　　　　# a.__setitem__(1,7)
del a[2]　　　　　　　# a.__delitem__(2)
5 in a　　　　　　　　# a.__contains__(5)
```

### 迭代

如果对象 obj 支持迭代，它必须提供方法 `obj.__iter__()`，该方法返回一个迭代器对象。而迭代器对象 iter 必须实现一个方法 `iter.next()`（在 Python 3 中为 `iter.__next__()`），该方法返回下一个对象，或者在迭代结束时引发 StopIteration 异常。

### 可调用接口

对象通过提供 `__call__(self [,*args [, **kwargs ]])` 方法可以模拟函数的行为。如果一个对象 x 提供了该方法，就可以像函数一样调用它。也就是说， `x(arg1, arg2,...)` 等同于调用 `x.__call__(self,arg1, arg2,...)`。

### 上下文管理协议

with 语句支持在另一个称为上下文管理器 的对象的控制下执行一系列语句。它的语法如下所示：

```py
with context [as var]:
    statements
```

执行with 语句时，就会调用 `__enter__()` 方法。该方法的返回值将被放入由可选的 `as var` 说明符指定的变量中。只要控制流离开与with 语句相关的语句块，就会立即调用 `__exit__()` 方法。`__exit__()` 方法接收当前异常的类型、值和跟踪作为参数。如果没有要处理的错误，所有3个值都将被置为 None 。

| 方法                                | 描述                                                                                                                                       |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| `__enter__( self )`                 | 进入新的上下文时调用该方法，其返回值将被放入由 with 语句的 as 说明符指定的变量中                                                           |
| `__exit__( self, type, value, tb )` | 实现该接口后，当执行离开使用对象的上下文时，该对象可以安全地释放资源。如果有异常出现，type 、value 和 tb的值分别为异常的类型、值和跟踪信息 |