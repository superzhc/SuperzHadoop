# 虚拟环境

## venv

venv 是 Python 自带的虚拟环境管理工具。

> 虚拟环境是一个包含了特定 Python 解析器以及一些软件包的自包含目录，不同的应用程序可以使用不同的虚拟环境，从而解决了依赖冲突问题，而且虚拟环境中只需要安装应用相关的包或者模块，可以给部署提供便利。

> 注意：venv 工具没法创建不同版本的 python 环境，也就是如果用户用 python3.5 没法创建 python3.6 的虚拟环境。如果想要使用不同 python 版本的虚拟环境，请安装 virtualenv 包。

### 创建虚拟环境

在 `test_venv` 目录下创建虚拟环境：

```shell
python -m venv test_venv
```

**参数**

- `--without-pip`：不需要安装 pip，默认为安装
- `--clear`：如果创建虚拟环境的目录已经有了其他虚拟环境，清除重建

### 激活

虚拟环境创建好后，需要激活才能在当前命令行中使用，可以理解成将当前命令行环境中 PATH 变量的值替换掉

- Windows 系统：激活脚本路径是 `<myvenv>\Scripts\activate.bat` ，如果是 powershell 命令行，脚本换成 `Activate.ps1`, 注意将 `<myvenv>` 换成你自己的虚拟环境目录
- Linux 系统：激活脚本路径 ~~是 `<myvenv>/bin/activate` ，默认脚本没有执行权限，要么设置脚本为可执行，要么~~ 用 source 命令执行，例如 `source <myvenv>/bin/activate`

### 修改 pip 的源

在创建的虚拟环境的根目录下创建 `pip.conf` 文件，内容如下：

```conf
[global]
index-url=https://mirrors.aliyun.com/pypi/simple
[install]
trusted-host=mirrors.aliyun.com
```

> **注意**：Windows 系统创建的文件是 `pip.ini`，Unix 系统创建的文件名称是 `pip.conf`

### 退出

退出虚拟环境很简单，只需要执行 deactivate 命令就行，这个命令也在虚拟环境的脚本目录下，因为激活时，将脚本目录设置到 PATH 中了，所以可以直接使用

## 虚拟环境[virtualenv]

virtualenv 用来创建和管理虚拟环境，virtualenvwrapper 是 virtualenv 的扩展包，可以更⽅便的新增、删除、复制、切换虚拟环境。

### virtualenv

**安装**

```shell
pip install virtualenv
```

**创建虚拟环境**

```shell
# virtualenv [虚拟环境名称] 
virtualenv venv

#如果不想使用系统的包,加上–no-site-packeages参数
virtualenv  --no-site-packages 创建路径名
```

**激活环境**

```shell
# Windows
cd venv
.\Scripts\activate.bat

# Linux
cd venv
source ./bin/activate
```

**退出环境**

```shell
# Windows
.\Scripts\deactivate.bat

# Linux
deactivate
```

**删除环境**

没有使用virtualenvwrapper前，可以直接删除venv文件夹来删除环境

### virtualenvwrapper

**安装**

```shell
# Windows
pip install virtualenvwrapper-win

# Linux
pip install --user virtualenvwrapper
echo "source virtualenvwrapper.sh" >> ~/.bashrc
source ~/.bashrc
```

**创建环境**

```shell
# on macOS/Linux:
mkvirtualenv --python=python3.6 venv
# on Windows
mkvirtualenv --python=python3 venv
```

**激活环境**

```shell
#workon #列出虚拟环境列表
workon [venv] #切换环境
```

**退出环境**

```shell
deactivate
```

**删除环境**

```shell
rmvirtualenv venv
```

**其他**

```shell
pip freeze #查看当前安装库版本
#创建 requirements.txt 文件，其中包含了当前环境中所有包及 各自的版本的简单列表
#保持部署相同，一键安装所有包
pip install -r requirements.txt
pip freeze > requirements.txt 
lsvirtualenv    #列举所有的环境
cdvirtualenv    #导航到当前激活的虚拟环境的目录中，相当于pushd 目录
cdsitepackages   # 和上面的类似，直接进入到 site-packages 目录
lssitepackages     #显示 site-packages 目录中的内容                                   # 删除虚拟环境（先退出再删除）
```

## Anaconda

### 创建环境

```sh
# 下面是创建python=3.6版本的环境，取名叫py36
conda create -n py36 python=3.6 
```

### 删除环境

```sh
conda remove -n py36 --all
```

### 激活环境

```sh
source activate py36

# conda4
conda activate py36
```

### 退出环境

```sh
source deactivate

# conda4
conda deactivate
```