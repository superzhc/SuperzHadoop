# 安装部署

> Airflow 版本：2.6.3
>
> 前提：
>
> - Python3 的环境，官方测试了  Python 3.7, 3.8, 3.9, 3.10
> - 数据库：
>   - PostgreSQL: 11, 12, 13, 14, 15
>   - MySQL: 5.7, 8
>   - SQLite: 3.15.0+
>   - MSSQL(Experimental): 2017, 2019

## 本地安装

### 1. **设置 Airflow Home**【可选】

Airflow 要求一个主目录，如果未设置，默认使用 `~/airflow`，若不使用默认路径，可通过设置环境 `AIRFLOW_HOME` 来指定 Airflow 主目录。

**Linux**

```sh
export AIRFLOW_HOME=~/airflow
```

**Windows PowerShell**

```sh
#Powershell设置环境变量

#查看所有环境变量，注意后面的冒号
ls env:

#搜索环境变量   
ls env:NODE*

#查看单个环境变量 
$env:NODE_ENV

#添加/更新环境变量 
$env:NODE_ENV=development

#删除环境变量        
del evn:NODE_ENV
```

```sh
$env:AIRFLOW_HOME="D:\\soft\\airflow"
```

### 2. **使用约束文件安装 Airflow**

**Linux**

```sh
AIRFLOW_VERSION=2.6.3

# Extract the version of Python you have installed. If you're currently using Python 3.11 you may want to set this manually as noted above, Python 3.11 is not yet supported.
PYTHON_VERSION="$(python --version | cut -d " " -f 2 | cut -d "." -f 1-2)"

CONSTRAINT_URL="https://raw.githubusercontent.com/apache/airflow/constraints-${AIRFLOW_VERSION}/constraints-${PYTHON_VERSION}.txt"
# For example this would install 2.6.3 with python 3.7: https://raw.githubusercontent.com/apache/airflow/constraints-2.6.3/constraints-3.7.txt

pip install "apache-airflow==${AIRFLOW_VERSION}" --constraint "${CONSTRAINT_URL}"
```

**Windows**

```sh
# 根据实际的Python及Airflow版本获取约束文件
pip install "apache-airflow==2.6.3" --constraint "https://raw.githubusercontent.com/apache/airflow/constraints-2.6.3/constraints-3.9.txt"
```

### 3. **启动**

> 默认 Airflow 会在 `$AIRFLOW_HOME` 目录下创建默认 `airflow.cfg` 配置文件，用户可使用环境变量来覆盖掉默认配置。

~~**运行 Airflow Standalone**~~

`airflow standalone` 命令会初始化数据库，创建用户和启动所有组件

**手动运行各部分**

```sh
airflow db init

airflow users create \
    --username admin \
    --firstname Peter \
    --lastname Parker \
    --role Admin \
    --email spiderman@superhero.org

airflow webserver --port 8080

airflow scheduler
```

### 4. 访问 Airflow UI

浏览器访问 `localhost:8080`