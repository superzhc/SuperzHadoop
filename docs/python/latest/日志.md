# 日志

> Python 标准库内置了 logging 模块，logging 模块定义的函数和类为应用程序和库的开发实现了一个灵活的事件日志系统。

## logging 模块的组件

| 组件名称       |    类名     | 描述                                                             |
| -------------- | :---------: | ---------------------------------------------------------------- |
| 日志记录器     |  `Logger`   | 提供了应用程序统一使用的接口                                     |
| 日志处理器     |  `Handler`  | 处理程序将日志记录（由记录器创建）发送到相应的目标               |
| 日志过滤器     |  `Filter`   | 提供了更细粒度的控制工具来决定输出哪条日志记录，丢弃哪条日志记录 |
| 日志格式化工具 | `Formatter` | 决定日志记录的最终输出格式                                       |

### `Logger`

> 提供日志记录的统一对外接口，应用程序直接使用该对象来进行日志输出。

**初始化**

```py
logger=logging.getLogger(...)
```

Logger 对象最常用的方法分为两类：*配置方法* 和 *消息发送方法* 。

最常用的配置方法如下：

| 方法                                              | 描述                                        |
| ------------------------------------------------- | ------------------------------------------- |
| `Logger.setLevel()`                               | 设置日志器将会处理的日志消息的最低严重级别  |
| `Logger.addHandler()` 和 `Logger.removeHandler()` | 为该 logger 对象添加和移除一个 handler 对象 |
| `Logger.addFilter()` 和 `Logger.removeFilter()`   | 为该 logger 对象添加和移除一个 filter 对象  |

创建日志记录

| 方法                                                                                         | 描述                                                |
| -------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| `Logger.debug()`, `Logger.info()`, `Logger.warning()`, `Logger.error()`, `Logger.critical()` | 创建一个与它们的方法名对应等级的日志记录            |
| `Logger.exception()`                                                                         | 创建一个类似于 `Logger.error()` 的日志消息          |
| `Logger.log()`                                                                               | 需要获取一个明确的日志 level 参数来创建一个日志记录 |

### `Handler`

> Handler 对象的作用是（基于日志消息的 level）将消息分发到 handler 指定的位置（文件、网络、邮件等）。Logger 对象可以通过 `addHandler()` 方法为自己添加 0 个或者更多个 handler 对象。

Handler 配置方法如下：

| 方法                                              | 描述                                          |
| ------------------------------------------------- | --------------------------------------------- |
| `Handler.setLevel()`                              | 设置 handler 将会处理的日志消息的最低严重级别 |
| `Handler.setFormatter()`                          | 为 handler 设置一个格式器对象                 |
| `Handler.addFilter()` 和 `Handler.removeFilter()` | 为 handler 添加和删除一个过滤器对象           |

**常用的处理器**：

| 处理器                                      | 描述                                                                                                                           |
| ------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `logging.StreamHandler`                     | 将日志消息发送到输出到 Stream，如 `std.out`, `std.err` 或任何 file-like 对象                                                   |
| `logging.FileHandler`                       | 将日志消息发送到磁盘文件，默认情况下文件大小会无限增长                                                                         |
| `logging.handlers.RotatingFileHandler`      | 将日志消息发送到磁盘文件，并支持日志文件按大小切割                                                                             |
| `logging.hanlders.TimedRotatingFileHandler` | 将日志消息发送到磁盘文件，并支持日志文件按时间切割                                                                             |
| `logging.handlers.HTTPHandler`              | 将日志消息以 GET 或 POST 的方式发送给一个 HTTP 服务器                                                                          |
| `logging.handlers.SMTPHandler`              | 将日志消息发送给一个指定的 email 地址                                                                                          |
| `logging.NullHandler`                       | 该 Handler 实例会忽略 error messages，通常被想使用 logging 的开发者使用来避免 `No handlers could be found for logger XXX` 报错 |

### `Filter`

> Filte r可以被 Handler 和 Logger 用来做比 level 更细粒度的、更复杂的过滤功能。

Filter 是一个过滤器基类，它只允许某个 logger 层级下的日志事件通过过滤。该类定义如下：

```py
class logging.Filter(name='')
    filter(record)
```

### `Formatter`

> Formater 对象用于配置日志信息的最终顺序、结构和内容

| 字段/属性名称   | 使用格式              | 描述                                                                              |
| --------------- | --------------------- | --------------------------------------------------------------------------------- |
| asctime         | `%(asctime)s`         | 日志事件发生的时间--人类可读时间，如：`2003-07-08 16:49:45,896`                   |
| created         | `%(created)f`         | 日志事件发生的时间--时间戳，就是当时调用 `time.time()` 函数返回的值               |
| relativeCreated | `%(relativeCreated)d` | 日志事件发生的时间相对于 logging 模块加载时间的相对毫秒数                         |
| msecs           | `%(msecs)d`           | 日志事件发生事件的毫秒部分                                                        |
| levelname       | `%(levelname)s`       | 该日志记录的文字形式的日志级别（'DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL'） |
| levelno         | `%(levelno)s`         | 该日志记录的数字形式的日志级别（10, 20, 30, 40, 50）                              |
| name            | `%(name)s`            | 所使用的日志器名称，默认是 `root`，因为默认使用的是 rootLogger                    |
| message         | `%(message)s`         | 日志记录的文本内容，通过 `msg % args` 计算得到的                                  |
| pathname        | `%(pathname)s`        | 调用日志记录函数的源码文件的全路径                                                |
| filename        | `%(filename)s`        | pathname 的文件名部分，包含文件后缀                                               |
| module          | `%(module)s`          | filename 的名称部分，不包含后缀                                                   |
| lineno          | `%(lineno)d`          | 调用日志记录函数的源代码所在的行号                                                |
| funcName        | `%(funcName)s`        | 调用日志记录函数的函数名                                                          |
| process         | `%(process)d`         | 进程ID                                                                            |
| processName     | `%(processName)s`     | 进程名称，Python 3.1新增                                                          |
| thread          | `%(thread)d`          | 线程ID                                                                            |
| threadName      | `%(thread)s`          | 线程名称                                                                          |


**示例**

```
'[%(asctime)s] [%(levelname)s] %(message)s', '%Y-%m-%d %H:%M:%S'
```