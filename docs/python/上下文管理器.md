# 上下文管理器（ContextManager）

上下文管理器是指在一段代码执行之前执行一段代码，用于一些预处理工作；执行之后再执行一段代码，用于一些清理工作。比如打开文件进行读写，读写完之后需要将文件关闭。又比如在数据库操作中，操作之前需要连接数据库，操作之后需要关闭数据库。在上下文管理协议中，有两个方法 `__enter__` 和 `__exit__`，分别实现上述两个功能。

## With 语法

**语法格式**

```py
with EXPR as VAR:
    BLOCK
```

运行逻辑：

1. 执行 EXPR 语句，获取上下文管理器（Context Manager）
2. 调用上下文管理器中的 `__enter__` 方法，该方法执行一些预处理工作
3. 这里的 `as VAR` 可以省略，如果不省略，则将 `__enter__` 方法的返回值赋值给 VAR
4. 执行代码块 BLOCK，这里的 VAR 可以当做普通变量使用
5. 最后调用上下文管理器中的的 `__exit__` 方法
6. `__exit__` 方法有三个参数：`exc_type`, `exc_val`, `exc_tb`。如果代码块 BLOCK 发生异常并退出，那么分别对应异常的 type、value 和 traceback。否则三个参数全为 None
7. `__exit__` 方法的返回值可以为 True 或者 False。如果为 True，那么表示异常被忽视，相当于进行了 try-except 操作；如果为 False，则该异常会被重新 raise